---
phase: 33-birthday-field-migration
plan: 02
type: execute
wave: 2
depends_on: ["33-01"]
files_modified:
  - lib/stadion-db.js
  - tools/validate-stadion-ids.js
  - tools/find-orphan-dates.js
  - tools/verify-stadion-data.js
  - docs/pipeline-people.md
  - docs/database-schema.md
  - docs/sync-architecture.md
  - docs/operations.md
  - docs/utility-scripts.md
  - docs/troubleshooting.md
  - docs/installation.md
  - scripts/sync.sh
  - CLAUDE.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "The stadion_important_dates table is no longer used by any active sync code"
    - "Documentation reflects birthdate as ACF field, not important_date post type"
    - "Tools that referenced important_dates are updated or removed"
  artifacts:
    - path: "lib/stadion-db.js"
      provides: "Deprecated important_dates functions with comments"
    - path: "docs/pipeline-people.md"
      provides: "Updated pipeline docs without Step 5"
  key_links:
    - from: "docs/pipeline-people.md"
      to: "steps/prepare-stadion-members.js"
      via: "Documents birthdate as ACF field in person sync"
      pattern: "birthdate"
---

<objective>
Deprecate the stadion_important_dates database table and update all documentation and tools to reflect the new birthdate-as-ACF-field architecture.

Purpose: Clean up references to the removed birthday sync step so docs and tools are accurate. The table schema stays in stadion-db.js for backward compatibility (won't break existing databases), but functions are marked deprecated.
Output: Updated docs, deprecated DB functions, cleaned-up tools.
</objective>

<execution_context>
@/Users/joostdevalk/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joostdevalk/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-birthday-field-migration/33-RESEARCH.md
@.planning/phases/33-birthday-field-migration/33-01-SUMMARY.md
@lib/stadion-db.js
@docs/pipeline-people.md
@docs/database-schema.md
@docs/sync-architecture.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deprecate DB functions and clean up tools</name>
  <files>lib/stadion-db.js, tools/validate-stadion-ids.js, tools/find-orphan-dates.js, tools/verify-stadion-data.js</files>
  <action>
**lib/stadion-db.js:**
1. Add a comment above the `stadion_important_dates` CREATE TABLE statement: `-- DEPRECATED (v2.3): Birthday sync now uses acf.birthdate on person. Table kept for backward compat.`
2. Add `@deprecated` JSDoc tag to each of the 7 important_date functions: `upsertImportantDate`, `getImportantDatesNeedingSync`, `updateImportantDateSyncState`, `getOrphanImportantDates`, `deleteImportantDate`, `getImportantDatesCount`, `getSyncedImportantDatesCount`, and also `computeDateHash`.
3. Keep the functions in module.exports (removing them would break tools that haven't been updated yet on servers).

**tools/validate-stadion-ids.js:**
Remove the `--reset-dates` functionality that resets `stadion_important_dates`. Remove the related console.log lines that mention important dates. Keep the rest of the tool intact.

**tools/find-orphan-dates.js:**
Add a deprecation notice at the top of the file as a console.warn: `console.warn('DEPRECATED: find-orphan-dates.js is no longer needed. Birthdays now sync as acf.birthdate on person records.');` Keep the file functional but warn on use.

**tools/verify-stadion-data.js:**
Remove `importantDates` from the verification config object (the block with `table: 'stadion_important_dates'`). Remove the corresponding mention in the help text at the bottom of the file.
  </action>
  <verify>
1. `node -e "require('./lib/stadion-db.js')"` loads without errors.
2. `node -e "require('./tools/validate-stadion-ids.js')"` loads without errors (if it has a require.main guard).
3. Grep for `@deprecated` in stadion-db.js shows the tagged functions.
  </verify>
  <done>
Important dates DB functions marked deprecated. Tools updated to reflect migration. No breaking changes to existing database schema.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update documentation</name>
  <files>docs/pipeline-people.md, docs/database-schema.md, docs/sync-architecture.md, docs/operations.md, docs/utility-scripts.md, docs/troubleshooting.md, docs/installation.md, scripts/sync.sh, CLAUDE.md, README.md</files>
  <action>
Update all documentation to reflect that birthdays now sync as `acf.birthdate` on the person record instead of as separate `important_date` posts.

**docs/pipeline-people.md:**
- Remove Step 5 from the pipeline flow diagram. Renumber Steps 6/7/8 to 5/6/7.
- Replace the Step 5 section with a note: birthdate is now included in Step 4 (Stadion person sync) as `acf.birthdate`.
- Remove `stadion_important_dates` from the database tables section.
- Remove `steps/sync-important-dates.js` from the scripts table.

**docs/database-schema.md:**
- Mark the `stadion_important_dates` section as `(DEPRECATED - v2.3)`. Add note: "Birthday sync migrated to acf.birthdate on person records. Table retained for backward compatibility."

**docs/sync-architecture.md:**
- Update the people pipeline description to not mention separate birthday sync.
- Remove the `steps/sync-important-dates.js` reference from the data flow diagram.
- Update the birthday field mapping: Source `DateOfBirth` now maps to `acf.birthdate` on person, not `wp/v2/important-dates`.
- Update the database table list to mark `stadion_important_dates` as deprecated.

**docs/operations.md:**
- Remove `node steps/sync-important-dates.js --verbose` from the individual step commands.
- Update the people sync description: "Members, parents, photos" (remove "birthdays" as separate concept).

**docs/utility-scripts.md:**
- Mark `find-orphan-dates.js` as deprecated.
- Remove `--reset-dates` from validate-stadion-ids.js docs.

**docs/troubleshooting.md:**
- Remove or update the "Find orphaned birthdays" section.

**docs/installation.md:**
- Update any mention of birthdays needing separate creation.
- Update the Stadion theme post type list if it mentions `important_date` in context of birthdays.

**scripts/sync.sh:**
- Update the comment on line 6 and the help text on line 49: change "birthdays" to just reflect that birthdate is part of person sync. E.g., line 6: `# sync.sh people   # 4x daily: download + laposta + stadion + photos`

**CLAUDE.md:**
- Update the Quick Reference comment for `scripts/sync.sh people` if it mentions "birthdays" as a separate thing.

**README.md:**
- Update any mention of birthday sync as a separate step.

Keep changes minimal and accurate. Don't rewrite entire sections -- just update the specific references.
  </action>
  <verify>
1. Grep for `sync-important-dates` across docs/ returns no active references (only deprecated notes).
2. Grep for `Step 5.*birthday` or `Step 5.*important` in docs/ returns no results.
3. All modified files are valid markdown (no broken formatting).
  </verify>
  <done>
All documentation accurately reflects the new architecture: birthdate syncs as ACF field on person during Step 4, no separate birthday sync step, stadion_important_dates table deprecated.
  </done>
</task>

</tasks>

<verification>
1. `node -e "require('./lib/stadion-db.js')"` -- loads without error
2. No active (non-deprecated) references to `sync-important-dates.js` in docs/
3. docs/pipeline-people.md shows birthdate in Step 4, no Step 5 birthday sync
4. docs/database-schema.md marks stadion_important_dates as deprecated
</verification>

<success_criteria>
- stadion_important_dates DB functions marked @deprecated
- tools/find-orphan-dates.js shows deprecation warning
- tools/validate-stadion-ids.js no longer has --reset-dates
- All docs updated to reflect birthdate-as-ACF-field architecture
- scripts/sync.sh help text updated
</success_criteria>

<output>
After completion, create `.planning/phases/33-birthday-field-migration/33-02-SUMMARY.md`
</output>
