---
phase: 04-email-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/send-email.js
autonomous: true

must_haves:
  truths:
    - "Email sender displays as 'Sportlink SYNC' in recipient's inbox"
    - "Email body renders as formatted HTML with proper structure"
    - "Plain text fallback available for text-only clients"
  artifacts:
    - path: "scripts/send-email.js"
      provides: "HTML email formatting with sender name"
      contains: "formatAsHtml"
  key_links:
    - from: "scripts/send-email.js"
      to: "postmark.sendEmail"
      via: "HtmlBody and From with display name"
      pattern: "HtmlBody.*formatAsHtml"
---

<objective>
Upgrade sync report emails to HTML format with proper sender identity.

Purpose: Email reports currently send as plain text with no sender name. This makes them harder to read and less recognizable in the inbox.

Output: Modified send-email.js that sends HTML-formatted emails from "Sportlink SYNC <email>".
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-email-polish/04-RESEARCH.md
@scripts/send-email.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add HTML formatting function</name>
  <files>scripts/send-email.js</files>
  <action>
Add a `formatAsHtml(textContent)` function that:
1. Escapes HTML entities (&, <, >) to prevent content from breaking HTML structure
2. Wraps the escaped content in a minimal HTML template using a `<pre>` tag to preserve formatting
3. Includes basic inline CSS for readability:
   - font-family: system fonts (-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif)
   - pre background: light gray (#f5f5f5)
   - pre padding: 10px
   - max-width to prevent overly wide emails on desktop

The function should be simple - just escape and wrap. Do NOT try to parse the log structure into semantic HTML elements. The `<pre>` tag preserves the existing text formatting which is already designed to be readable.
  </action>
  <verify>Function exists in file and handles special characters correctly</verify>
  <done>formatAsHtml function added that escapes content and wraps in HTML template</done>
</task>

<task type="auto">
  <name>Task 2: Update sendEmail to use HTML and From name</name>
  <files>scripts/send-email.js</files>
  <action>
Modify the `sendEmail` function to:

1. Change the `From` field from:
   ```javascript
   From: process.env.POSTMARK_FROM_EMAIL
   ```
   To:
   ```javascript
   From: `Sportlink SYNC <${process.env.POSTMARK_FROM_EMAIL}>`
   ```
   This format is standard RFC 5322 and supported by Postmark.

2. Add HtmlBody using the new formatAsHtml function:
   ```javascript
   HtmlBody: formatAsHtml(logContent)
   ```

3. Keep TextBody as fallback (already exists):
   ```javascript
   TextBody: logContent
   ```

The final sendEmail call should have: From (with name), To, Subject, HtmlBody, and TextBody.
  </action>
  <verify>Run `node scripts/send-email.js` without args to see usage - should not error. Inspect the code to confirm both HtmlBody and TextBody are sent.</verify>
  <done>sendEmail sends HTML email with "Sportlink SYNC" as sender display name and plain text fallback</done>
</task>

</tasks>

<verification>
1. Code inspection: `grep -n "Sportlink SYNC" scripts/send-email.js` shows the From line
2. Code inspection: `grep -n "HtmlBody" scripts/send-email.js` shows HTML is sent
3. Code inspection: `grep -n "TextBody" scripts/send-email.js` shows fallback is kept
4. Syntax check: `node -c scripts/send-email.js` returns no errors
</verification>

<success_criteria>
1. scripts/send-email.js contains formatAsHtml function
2. From field includes "Sportlink SYNC" display name
3. Both HtmlBody and TextBody are sent to Postmark
4. Script runs without syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-email-polish/04-01-SUMMARY.md`
</output>
