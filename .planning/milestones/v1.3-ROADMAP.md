# Milestone v1.3: Connect to Stadion

**Status:** ✅ SHIPPED 2026-01-25
**Phases:** 5-8
**Total Plans:** 8

## Overview

Sync Sportlink member data to Stadion WordPress app via REST API. Adds a second sync destination alongside Laposta, with member and parent sync, hash-based change detection, and unified email reports.

## Phases

### Phase 5: Stadion Foundation

**Goal**: Stadion API client is operational and can make authenticated requests
**Depends on**: Nothing (new integration)
**Plans**: 1 plan

Plans:
- [x] 05-01: Stadion API client with authentication and error handling

**Details:**
- WordPress REST API client with application password authentication
- Credential validation (RONDO_URL, RONDO_USERNAME, RONDO_APP_PASSWORD)
- 30 second timeout handling
- Structured error responses with details property
- CLI entry point for connection testing

### Phase 6: Member Sync

**Goal**: Members sync from Sportlink to Stadion with all field mappings
**Depends on**: Phase 5
**Plans**: 3 plans

Plans:
- [x] 06-01: Stadion database module for hash-based change detection
- [x] 06-02: Field mapping and member preparation
- [x] 06-03: Sync execution with matching and CRUD operations

**Details:**
- SQLite state tracking for Stadion members (separate from Laposta)
- Field mapping to ACF structure (contact_info, addresses repeaters)
- KNVB ID matching with email fallback
- Hash-based change detection skips unchanged members
- Rate limiting (2 second delays between requests)
- Error collection and reporting

### Phase 7: Parent Sync

**Goal**: Parents sync as separate person records linked to children
**Depends on**: Phase 6
**Plans**: 3 plans

Plans:
- [x] 07-01: Shared parent deduplication module (lib/parent-dedupe.js)
- [x] 07-02: Parent preparation with extraction and deduplication
- [x] 07-03: Parent sync execution with relationship linking

**Details:**
- Parents as separate person records (not contact info on child)
- Email-based matching (parents have no KNVB ID)
- Bidirectional relationship linking (parent.children and child.parents)
- Phone number merging from multiple children
- Orphan parent cleanup

### Phase 8: Pipeline Integration

**Goal**: Stadion sync is part of automated daily pipeline with email reports
**Depends on**: Phase 7
**Plans**: 1 plan

Plans:
- [x] 08-01: Integrate Stadion into sync-all pipeline and email reports

**Details:**
- sync-all.js orchestrates both Laposta and Stadion syncs
- Stadion runs as Step 4 (after Laposta)
- Combined email reports with separate system sections
- Consolidated error handling with system tags
- Stadion failures don't fail overall pipeline

---

## Milestone Summary

**Key Decisions:**
- WordPress application password auth (simpler than browser automation)
- KNVB ID as primary match key with email fallback
- Parents as separate person records for proper relationship modeling
- Bidirectional relationship linking (parent.children and child.parents)
- Stadion sync non-critical (pipeline continues if Stadion fails)
- 2 second API rate limiting to prevent WordPress timeout

**Issues Resolved:**
- WordPress REST API can't search ACF repeater fields (solved with client-side filtering)
- Parent matching without KNVB ID (solved with email-only matching)
- Relationship linking direction (solved with bidirectional updates)

**Issues Deferred:**
- Bidirectional sync (Stadion → Sportlink) — deferred to future milestone
- Photo sync — not needed currently
- Delete sync — members stay in downstream systems

**Technical Debt Incurred:**
- Email fallback fetches up to 100 recent persons (may miss older records without KNVB ID)

---

*For current project status, see .planning/ROADMAP.md*
